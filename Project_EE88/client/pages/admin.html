<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Agent Hub ‚Äî Qu·∫£n l√Ω</title>
  <link rel="stylesheet" href="/lib/layui/css/layui.css">
  <style>
    html, body { margin: 0; padding: 0; height: 100%; overflow: hidden; }

    /* ‚îÄ‚îÄ Logo ‚îÄ‚îÄ */
    .layui-logo .layui-icon { font-size: 26px; color: #ff4d4f; margin-right: 6px; vertical-align: middle; }
    .layui-logo span { color: #ff4d4f; vertical-align: middle; font-weight: bold; }

    /* ‚îÄ‚îÄ Sidebar ‚îÄ‚îÄ */
    .hub-sidebar {
      position: fixed;
      top: 50px;
      left: 0;
      bottom: 0;
      width: 200px;
      background: #20222A;
      overflow-y: auto;
      transition: width .3s;
      z-index: 999;
    }
    .hub-sidebar .layui-nav {
      background: transparent;
      width: 100%;
    }
    .hub-sidebar .layui-nav .layui-nav-item a {
      color: #ccc;
    }
    .hub-sidebar .layui-nav .layui-nav-item a:hover,
    .hub-sidebar .layui-nav .layui-this a {
      color: #fff;
      background: rgba(255,255,255,0.08);
    }


    /* ‚îÄ‚îÄ Body ‚îÄ‚îÄ */
    .hub-body {
      position: fixed;
      top: 50px;
      left: 200px;
      right: 0;
      bottom: 0;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      transition: left .3s;
    }

    /* ‚îÄ‚îÄ Collapsed ‚îÄ‚îÄ */
    .hub-sidebar .layui-nav-item > a > span { transition: opacity .3s; }
    body.hub-collapsed .layui-logo { width: 60px; }
    body.hub-collapsed .layui-logo span { display: none; }
    body.hub-collapsed .layui-logo .layui-icon { margin-right: 0 !important; font-size: 28px; }
    body.hub-collapsed .layui-layout-left { left: 60px; }
    body.hub-collapsed .hub-sidebar { width: 60px; }
    body.hub-collapsed .hub-body { left: 60px; }
    body.hub-collapsed .hub-sidebar .layui-nav.layui-nav-tree { width: 60px; }
    body.hub-collapsed .hub-sidebar .layui-nav-item > a > span { display: none; }
    body.hub-collapsed .hub-sidebar .layui-nav-item > a > .layui-icon:first-child { width: 100%; margin-right: 0 !important; text-align: center; font-size: 20px; }
    body.hub-collapsed .hub-sidebar .layui-nav-more { display: none !important; }
    body.hub-collapsed .hub-sidebar .layui-nav-child { display: none !important; }
    body.hub-collapsed .hub-sidebar .layui-nav-item > a { padding-left: 0; padding-right: 0; text-align: center; }

    /* ‚îÄ‚îÄ Tabs ‚îÄ‚îÄ */
    .hub-body .layui-tabs {
      margin: 0;
      display: flex;
      flex-direction: column;
      height: 100%;
    }
    .hub-body .layui-tabs-body {
      flex: 1;
      padding: 0;
      overflow: hidden;
    }
    .hub-body .layui-tabs-item {
      height: 100%;
    }
    .hub-body .layui-tabs-item iframe {
      width: 100%;
      height: 100%;
      border: none;
    }
  </style>
</head>
<body>

<div class="layui-layout layui-layout-admin">
  <!-- Header -->
  <div class="layui-header">
    <div class="layui-logo layui-hide-xs">
      <i class="layui-icon layui-icon-firefox"></i><span>FIRE</span>
    </div>
    <ul class="layui-nav layui-layout-left">
      <!-- Mobile menu toggle -->
      <li class="layui-nav-item layui-show-xs-inline-block layui-hide-sm" lay-header-event="menuLeft">
        <i class="layui-icon layui-icon-spread-left"></i>
      </li>
      <li class="layui-nav-item layui-hide-xs">
        <a href="javascript:;" id="btnToggle" title="Thu g·ªçn menu"><i class="layui-icon layui-icon-shrink-right"></i></a>
      </li>
      <li class="layui-nav-item layui-hide-xs">
        <a href="javascript:;" id="btnRefresh" title="T·∫£i l·∫°i trang"><i class="layui-icon layui-icon-refresh"></i></a>
      </li>
    </ul>
    <ul class="layui-nav layui-layout-right" lay-filter="hub-account">
      <li class="layui-nav-item" id="navLang">
        <a href="javascript:;"><i class="layui-icon layui-icon-website" style="margin-right: 4px;"></i><span id="langLabel"></span></a>
        <dl class="layui-nav-child">
          <dd><a href="javascript:;" data-lang="vi">üáªüá≥ Ti·∫øng Vi·ªát</a></dd>
          <dd><a href="javascript:;" data-lang="en">üá∫üá∏ English</a></dd>
          <dd><a href="javascript:;" data-lang="zh-CN">üá®üá≥ ‰∏≠Êñá</a></dd>
        </dl>
      </li>
      <li class="layui-nav-item">
        <a href="javascript:;" id="btnFullscreen" title="To√†n m√†n h√¨nh"><i class="layui-icon layui-icon-screen-full"></i></a>
      </li>
      <li class="layui-nav-item layui-hide layui-show-sm-inline-block">
        <a href="javascript:;">
          <img src="//unpkg.com/outeres@0.0.10/img/layui/icon-v2.png" class="layui-nav-img">
          <span id="userInfo"></span>
        </a>
        <dl class="layui-nav-child">
          <dd><a href="javascript:;" id="navProfile" data-i18n="accountInfo">Th√¥ng tin t√†i kho·∫£n</a></dd>
          <dd><a href="javascript:;" id="navSettings" data-i18n="settings">C√†i ƒë·∫∑t</a></dd>
          <hr>
          <dd style="text-align: center;"><a href="javascript:;" id="navLogout" data-i18n="logout">ƒêƒÉng xu·∫•t</a></dd>
        </dl>
      </li>
      <li class="layui-nav-item" lay-header-event="menuRight">
        <a href="javascript:;">
          <i class="layui-icon layui-icon-more-vertical"></i>
        </a>
      </li>
    </ul>
  </div>

  <!-- Sidebar -->
  <div class="hub-sidebar">
    <ul class="layui-nav layui-nav-tree" lay-shrink="all" lay-filter="hub-menu">
      <!-- 1. Qu·∫£n l√≠ h·ªôi vi√™n -->
      <li class="layui-nav-item layui-nav-itemed">
        <a href="javascript:;">
          <i class="layui-icon layui-icon-username" style="margin-right: 6px;"></i><span data-i18n="memberMgmt">Qu·∫£n l√≠ h·ªôi vi√™n</span>
        </a>
        <dl class="layui-nav-child">
          <dd class="layui-this">
            <a href="javascript:;" data-url="/pages/agent/user.html" data-title-i18n="members" data-title="H·ªôi vi√™n" data-i18n="members">H·ªôi vi√™n</a>
          </dd>
        </dl>
      </li>
      <!-- 2. M√£ gi·ªõi thi·ªáu -->
      <li class="layui-nav-item">
        <a href="javascript:;">
          <i class="layui-icon layui-icon-vercode" style="margin-right: 6px;"></i><span data-i18n="referralCode">M√£ gi·ªõi thi·ªáu</span>
        </a>
        <dl class="layui-nav-child">
          <dd>
            <a href="javascript:;" data-url="/pages/agent/inviteList.html" data-title-i18n="referralCode" data-title="M√£ gi·ªõi thi·ªáu" data-i18n="referralCode">M√£ gi·ªõi thi·ªáu</a>
          </dd>
        </dl>
      </li>
      <!-- 3. B√°o c√°o -->
      <li class="layui-nav-item">
        <a href="javascript:;">
          <i class="layui-icon layui-icon-tabs" style="margin-right: 6px;"></i><span data-i18n="reports">B√°o c√°o</span>
        </a>
        <dl class="layui-nav-child">
          <dd>
            <a href="javascript:;" data-url="/pages/agent/reportLottery.html" data-title-i18n="lotteryReport" data-title="BC x·ªï s·ªë" data-i18n="lotteryReport">BC x·ªï s·ªë</a>
          </dd>
          <dd>
            <a href="javascript:;" data-url="/pages/agent/reportFunds.html" data-title-i18n="transStatement" data-title="Sao k√™ giao d·ªãch" data-i18n="transStatement">Sao k√™ giao d·ªãch</a>
          </dd>
          <dd>
            <a href="javascript:;" data-url="/pages/agent/reportThirdGame.html" data-title-i18n="providerReport" data-title="BC nh√† cung c·∫•p" data-i18n="providerReport">BC nh√† cung c·∫•p</a>
          </dd>
        </dl>
      </li>
      <!-- 4. R√∫t hoa h·ªìng -->
      <li class="layui-nav-item">
        <a href="javascript:;">
          <i class="layui-icon layui-icon-dollar" style="margin-right: 6px;"></i><span data-i18n="commission">R√∫t hoa h·ªìng</span>
        </a>
        <dl class="layui-nav-child">
          <dd>
            <a href="javascript:;" data-url="/pages/agent/depositAndWithdrawal.html" data-title-i18n="deposit" data-title="N·∫°p ti·ªÅn" data-i18n="deposit">N·∫°p ti·ªÅn</a>
          </dd>
          <dd>
            <a href="javascript:;" data-url="/pages/agent/withdrawalsRecord.html" data-title-i18n="withdraw" data-title="R√∫t ti·ªÅn" data-i18n="withdraw">R√∫t ti·ªÅn</a>
          </dd>
        </dl>
      </li>
      <!-- 5. ƒê∆°n c∆∞·ª£c -->
      <li class="layui-nav-item">
        <a href="javascript:;">
          <i class="layui-icon layui-icon-chart-screen" style="margin-right: 6px;"></i><span data-i18n="betOrders">ƒê∆°n c∆∞·ª£c</span>
        </a>
        <dl class="layui-nav-child">
          <dd>
            <a href="javascript:;" data-url="/pages/agent/bet.html" data-title-i18n="lotteryBet" data-title="ƒê∆°n c∆∞·ª£c x·ªï s·ªë" data-i18n="lotteryBet">ƒê∆°n c∆∞·ª£c x·ªï s·ªë</a>
          </dd>
          <dd>
            <a href="javascript:;" data-url="/pages/agent/betOrder.html" data-title-i18n="thirdPartyBet" data-title="C∆∞·ª£c b√™n th·ª© 3" data-i18n="thirdPartyBet">C∆∞·ª£c b√™n th·ª© 3</a>
          </dd>
        </dl>
      </li>
      <!-- 6. Kh√°ch h√†ng -->
      <li class="layui-nav-item">
        <a href="javascript:;">
          <i class="layui-icon layui-icon-survey" style="margin-right: 6px;"></i><span data-i18n="customer">Kh√°ch h√†ng</span>
        </a>
        <dl class="layui-nav-child">
          <dd>
            <a href="javascript:;" data-url="/pages/agent/editPassword.html" data-title-i18n="changeLoginPw" data-title="ƒê·ªïi MK ƒëƒÉng nh·∫≠p" data-i18n="changeLoginPw">ƒê·ªïi MK ƒëƒÉng nh·∫≠p</a>
          </dd>
          <dd>
            <a href="javascript:;" data-url="/pages/agent/editFundPassword.html" data-title-i18n="changeFundPw" data-title="ƒê·ªïi MK giao d·ªãch" data-i18n="changeFundPw">ƒê·ªïi MK giao d·ªãch</a>
          </dd>
        </dl>
      </li>
      <!-- 7. T·ªâ l·ªá ho√†n tr·∫£ -->
      <li class="layui-nav-item">
        <a href="javascript:;">
          <i class="layui-icon layui-icon-list" style="margin-right: 6px;"></i><span data-i18n="rebateRate">T·ªâ l·ªá ho√†n tr·∫£</span>
        </a>
        <dl class="layui-nav-child">
          <dd>
            <a href="javascript:;" data-url="/pages/agent/getRebateOddsPanel.html" data-title-i18n="rebateRate" data-title="T·ªâ l·ªá ho√†n tr·∫£" data-i18n="rebateRate">T·ªâ l·ªá ho√†n tr·∫£</a>
          </dd>
        </dl>
      </li>
      <!-- 8. Qu·∫£n l√Ω (admin only) -->
      <li class="layui-nav-item" id="menuManage" style="display:none;">
        <a href="javascript:;">
          <i class="layui-icon layui-icon-set" style="margin-right: 6px;"></i><span data-i18n="management">Qu·∫£n l√Ω</span>
        </a>
        <dl class="layui-nav-child">
          <dd>
            <a href="javascript:;" data-url="/pages/manage/manageAgents.html" data-title-i18n="manageAgents" data-title="Qu·∫£n l√Ω Agents" data-i18n="manageAgents">Qu·∫£n l√Ω Agents</a>
          </dd>
          <dd>
            <a href="javascript:;" data-url="/pages/manage/manageUsers.html" data-title-i18n="manageUsers" data-title="Qu·∫£n l√Ω Users" data-i18n="manageUsers">Qu·∫£n l√Ω Users</a>
          </dd>
        </dl>
      </li>
    </ul>
  </div>

  <!-- Body -->
  <div class="hub-body">
    <div class="layui-tabs layui-hide-v" id="hubTabs" lay-options="{closable: true, headerMode: 'scroll'}">
      <ul class="layui-tabs-header"></ul>
      <div class="layui-tabs-body"></div>
    </div>
  </div>
</div>

  <script src="/lib/layui/layui.js"></script>
  <script src="/js/hub-api.js"></script>
  <script src="/js/hub-lang.js"></script>
  <script>
    // ‚îÄ‚îÄ Auth guard ‚îÄ‚îÄ
    if (!HubAPI.isLoggedIn()) {
      window.location.href = '/pages/login.html';
    }

    // ‚îÄ‚îÄ Init i18n tr∆∞·ªõc khi layui.use ‚îÄ‚îÄ
    HubLang.init();

    layui.use(['element', 'tabs', 'dropdown', 'layer', 'util', 'i18n'], function () {
      var $ = layui.$;
      var element = layui.element;
      var tabs = layui.tabs;
      var dropdown = layui.dropdown;
      var layer = layui.layer;
      var util = layui.util;
      var openedTabs = {};
      var TABS_ID = 'hubTabs';

      // ‚îÄ‚îÄ Hi·ªÉn th·ªã user info ‚îÄ‚îÄ
      var user = HubAPI.getUser();
      if (user) {
        document.getElementById('userInfo').textContent = user.username;
        if (user.role === 'admin') {
          document.getElementById('menuManage').style.display = '';
        }
      }

      // ‚îÄ‚îÄ i18n: apply DOM + update lang label ‚îÄ‚îÄ
      function applyI18n() {
        HubLang.applyDOM();
        var lang = HubLang.getLang();
        var info = HubLang.LANGS[lang];
        document.getElementById('langLabel').textContent = info ? info.label : lang;
        $('[data-title-i18n]').each(function () {
          $(this).attr('data-title', HubLang.t($(this).attr('data-title-i18n')));
        });
      }
      applyI18n();

      // ‚îÄ‚îÄ Header nav events (language switch + account) ‚îÄ‚îÄ
      element.on('nav(hub-account)', function (elem) {
        // Language switch
        var lang = elem.attr('data-lang');
        if (lang) {
          HubLang.setLang(lang);
          applyI18n();
          dropdownInst.config.data = getContextMenuData();
          return;
        }
        // Logout
        if (elem.attr('id') === 'navLogout') {
          HubAPI.logout();
          return;
        }
        // Open tab
        var url = elem.attr('data-url');
        var title = elem.attr('data-title');
        if (!url) return;
        if (openedTabs[url]) {
          tabs.change(TABS_ID, url);
        } else {
          tabs.add(TABS_ID, {
            title: title,
            content: '<iframe src="' + url + '"></iframe>',
            id: url,
            done: function (data) {
              dropdown.render($.extend({}, dropdownInst.config, { elem: data.headerItem }));
            }
          });
          openedTabs[url] = true;
        }
        document.title = 'Agent Hub ‚Äî ' + (title || '');
      });

      // ‚îÄ‚îÄ Header events (layui util.event pattern) ‚îÄ‚îÄ
      util.event('lay-header-event', {
        menuLeft: function () {
          document.getElementById('btnToggle').click();
        },
        menuRight: function () {
          layer.open({
            type: 1,
            title: HubLang.t('options'),
            content: '<div style="padding: 15px;"><p>' + HubLang.t('noOptions') + '</p></div>',
            area: ['260px', '100%'],
            offset: 'rt',
            anim: 'slideLeft',
            shadeClose: true,
            scrollbar: false
          });
        }
      });

      // ‚îÄ‚îÄ Right-click context menu cho tab header ‚îÄ‚îÄ
      function getContextMenuData() {
        return [
          { title: HubLang.t('closeTab'), action: 'close', mode: 'this' },
          { title: HubLang.t('closeOther'), action: 'close', mode: 'other' },
          { title: HubLang.t('closeRight'), action: 'close', mode: 'right' },
          { type: '-' },
          { title: HubLang.t('closeAll'), action: 'close', mode: 'all' }
        ];
      }
      var dropdownInst = dropdown.render({
        elem: '#' + TABS_ID + ' .layui-tabs-header>li',
        trigger: 'contextmenu',
        data: getContextMenuData(),
        click: function (data) {
          var index = this.elem.index();
          if (data.mode === 'this') {
            tabs.close(TABS_ID, index);
          } else {
            tabs.closeMult(TABS_ID, data.mode, index);
          }
        }
      });

      // ‚îÄ‚îÄ Click menu ‚Üí m·ªü tab ho·∫∑c chuy·ªÉn sang tab ƒë√£ m·ªü ‚îÄ‚îÄ
      element.on('nav(hub-menu)', function (elem) {
        var url = elem.attr('data-url');
        var titleKey = elem.attr('data-title-i18n');
        var title = titleKey ? HubLang.t(titleKey) : elem.attr('data-title');
        if (!url) return;

        if (openedTabs[url]) {
          tabs.change(TABS_ID, url);
        } else {
          tabs.add(TABS_ID, {
            title: title,
            content: '<iframe src="' + url + '"></iframe>',
            id: url,
            done: function (data) {
              dropdown.render($.extend({}, dropdownInst.config, { elem: data.headerItem }));
            }
          });
          openedTabs[url] = true;
        }
        document.title = 'Agent Hub ‚Äî ' + (title || '');
      });

      // ‚îÄ‚îÄ Xo√° tab ‚Üí d·ªçn d·∫πp openedTabs ‚îÄ‚îÄ
      tabs.on('close(' + TABS_ID + ')', function (data) {
        var id = data.id;
        if (id) delete openedTabs[id];
      });

      // ‚îÄ‚îÄ Toggle sidebar ‚îÄ‚îÄ
      var toggleIcon = document.querySelector('#btnToggle .layui-icon');
      document.getElementById('btnToggle').addEventListener('click', function () {
        var collapsed = document.body.classList.toggle('hub-collapsed');
        if (collapsed) {
          toggleIcon.className = 'layui-icon layui-icon-spread-left';
          document.querySelectorAll('.hub-sidebar .layui-nav-itemed').forEach(function (el) { el.classList.remove('layui-nav-itemed'); });
        } else {
          toggleIcon.className = 'layui-icon layui-icon-shrink-right';
        }
      });

      // ‚îÄ‚îÄ Refresh tab hi·ªán t·∫°i ‚îÄ‚îÄ
      document.getElementById('btnRefresh').addEventListener('click', function () {
        var active = document.querySelector('.hub-body .layui-tabs-item.layui-show iframe');
        if (active) active.contentWindow.location.reload();
      });

      // ‚îÄ‚îÄ Fullscreen ‚îÄ‚îÄ
      var fsIcon = document.querySelector('#btnFullscreen .layui-icon');
      document.getElementById('btnFullscreen').addEventListener('click', function () {
        if (!document.fullscreenElement) {
          document.documentElement.requestFullscreen();
          fsIcon.className = 'layui-icon layui-icon-screen-restore';
        } else {
          document.exitFullscreen();
          fsIcon.className = 'layui-icon layui-icon-screen-full';
        }
      });

      // ‚îÄ‚îÄ Layer tips cho header buttons (i18n) ‚îÄ‚îÄ
      var tipKeys = { btnToggle: 'toggleMenu', btnRefresh: 'reload', btnFullscreen: 'fullscreen' };
      $('#btnToggle, #btnRefresh, #btnFullscreen').each(function () {
        var el = this;
        el.removeAttribute('title');
        $(el).on('mouseenter', function () {
          layer.tips(HubLang.t(tipKeys[el.id]), el, { tips: [3, '#393D49'], time: 1500 });
        }).on('mouseleave', function () {
          layer.closeAll('tips');
        });
      });

      // ‚îÄ‚îÄ Layer tips cho sidebar khi collapsed (i18n) ‚îÄ‚îÄ
      $('.hub-sidebar .layui-nav-item > a').each(function () {
        var el = this;
        var span = $(el).find('span[data-i18n]');
        if (!span.length) return;
        var key = span.attr('data-i18n');
        $(el).on('mouseenter', function () {
          if (!document.body.classList.contains('hub-collapsed')) return;
          layer.tips(HubLang.t(key), el, { tips: [2, '#393D49'], time: 1500 });
        }).on('mouseleave', function () {
          layer.closeAll('tips');
        });
      });

      // Auto-load trang ƒë·∫ßu ti√™n
      var firstLink = document.querySelector('.hub-sidebar .layui-this a[data-url]');
      if (firstLink) firstLink.click();
    });
  </script>
</body>
</html>
