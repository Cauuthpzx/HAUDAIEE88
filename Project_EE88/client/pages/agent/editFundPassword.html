<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Đổi mật khẩu giao dịch</title>
    <link rel="stylesheet" href="/lib/layui/css/layui.css" />
    <style>
      body {
        margin: 0;
        padding: 0;
        background: #f2f2f2;
        font-family: sans-serif;
      }
      .layui-card {
        margin: 15px;
      }
      .layui-card-header {
        padding-bottom: 0;
        border-bottom: none;
      }
      .layui-field-box .layui-inline {
        margin-bottom: 8px;
      }
      .layui-field-box .layui-inline label {
        font-size: 13px;
        margin-right: 5px;
      }
    </style>
  </head>
  <body>
    <div class="layui-row">
      <div class="layui-col-md12">
        <div class="layui-card">
          <div class="layui-card-header" data-i18n="editFundPwTitle">
            Đổi mật khẩu giao dịch
          </div>
          <div class="layui-card-body" style="padding: 15px">
            <form class="layui-form" lay-filter="editFundPwdForm">
              <div class="layui-form-item">
                <label class="layui-form-label" data-i18n="oldPw"
                  >Mật khẩu cũ</label
                >
                <div class="layui-input-block">
                  <input
                    type="password"
                    autocomplete="off"
                    name="oldPwd"
                    placeholder="Bạn vẫn chưa cài đặt mật khẩu giao dịch, mặc định để trống"
                    data-i18n="fundPwOldHint"
                    data-i18n-attr="placeholder"
                    class="layui-input"
                  />
                </div>
              </div>
              <div class="layui-form-item">
                <label class="layui-form-label" data-i18n="newPassword"
                  >Mật khẩu mới</label
                >
                <div class="layui-input-block">
                  <input
                    type="password"
                    lay-verify="required"
                    autocomplete="off"
                    name="newPwd"
                    placeholder="Mật khẩu mới"
                    data-i18n="newPassword"
                    data-i18n-attr="placeholder"
                    class="layui-input"
                  />
                </div>
              </div>
              <div class="layui-form-item">
                <label class="layui-form-label" data-i18n="confirmNewPw"
                  >Xác nhận mật khẩu mới</label
                >
                <div class="layui-input-block">
                  <input
                    type="password"
                    lay-verify="required"
                    autocomplete="off"
                    name="confirmPwd"
                    placeholder="Nhập xác nhận mật khẩu mới"
                    data-i18n="enterConfirmNewPw"
                    data-i18n-attr="placeholder"
                    class="layui-input"
                  />
                </div>
              </div>
              <div class="layui-form-item layui-layout-admin">
                <div class="layui-input-block">
                  <button
                    type="button"
                    lay-submit
                    lay-filter="doSubmit"
                    class="layui-btn"
                  >
                    <span data-i18n="submit">Gửi đi</span>
                  </button>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <script src="/lib/layui/layui.js"></script>
    <script src="/js/hub-lang.js"></script>
    <script src="/js/hub-api.js"></script>
    <script>
      layui.use(['form', 'layer'], function () {
        HubLang.init();
        HubLang.applyDOM();
        document.title = HubLang.t('editFundPwTitle');
        var form = layui.form;
        var layer = layui.layer;
        var $ = layui.$;

        form.on('submit(doSubmit)', function (data) {
          var field = data.field;

          if (field.newPwd !== field.confirmPwd) {
            layer.msg(HubLang.t('pwMismatch'), { icon: 5 });
            return false;
          }

          var loading = layer.load(1);
          $.ajax({
            url: '/api/action/editFundPassword',
            method: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(field),
            success: function (res) {
              layer.close(loading);
              if (res.code === 0) {
                layer.msg(HubLang.t('fundPwChangeSuccess'), { icon: 1 });
              } else {
                layer.msg(res.msg || HubLang.t('fundPwChangeFailed'), {
                  icon: 2
                });
              }
            },
            error: function () {
              layer.close(loading);
              layer.msg(HubLang.t('serverError'), { icon: 2 });
            }
          });
          return false;
        });
      });
    </script>
  </body>
</html>
