<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Agent Hub — Đăng nhập</title>
    <link rel="stylesheet" href="/lib/layui/css/layui.css" />
    <style>
      html,
      body {
        margin: 0;
        padding: 0;
        height: 100%;
        background: #20222a;
      }
      .login-wrap {
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
      }
      .login-box {
        width: 380px;
        background: #fff;
        border-radius: 8px;
        padding: 40px 35px 30px;
        box-shadow: 0 4px 24px rgba(0, 0, 0, 0.3);
      }
      .login-logo {
        text-align: center;
        margin-bottom: 30px;
      }
      .login-logo .hi {
        font-size: 40px;
        color: #ff4d4f;
        vertical-align: middle;
        margin-right: 10px;
      }
      .login-logo span {
        font-size: 22px;
        font-weight: 700;
        color: #333;
        vertical-align: middle;
      }
      .login-box .layui-form-item {
        margin-bottom: 20px;
      }
      .login-box .layui-input {
        height: 42px;
        line-height: 42px;
        border-radius: 4px;
      }
      .login-box .layui-btn {
        height: 42px;
        line-height: 42px;
        border-radius: 4px;
        font-size: 15px;
      }
      .login-footer {
        text-align: center;
        color: #999;
        font-size: 12px;
        margin-top: 15px;
      }
    </style>
  </head>
  <body>
    <div class="login-wrap">
      <div class="login-box">
        <div class="login-logo">
          <i class="hi hi-fire-flame-curved"></i><span>HUB</span>
        </div>
        <form class="layui-form" lay-filter="loginForm">
          <div class="layui-form-item">
            <div class="layui-input-wrap">
              <div class="layui-input-prefix">
                <i class="layui-icon layui-icon-username"></i>
              </div>
              <input
                type="text"
                name="username"
                lay-verify="required"
                data-i18n="username"
                data-i18n-attr="placeholder"
                placeholder="Tên đăng nhập"
                lay-reqtext="Vui lòng nhập tên đăng nhập"
                autocomplete="off"
                class="layui-input"
                lay-affix="clear"
                autofocus
              />
            </div>
          </div>
          <div class="layui-form-item">
            <div class="layui-input-wrap">
              <div class="layui-input-prefix">
                <i class="layui-icon layui-icon-password"></i>
              </div>
              <input
                type="password"
                name="password"
                lay-verify="required"
                data-i18n="password"
                data-i18n-attr="placeholder"
                placeholder="Mật khẩu"
                lay-reqtext="Vui lòng nhập mật khẩu"
                autocomplete="off"
                class="layui-input"
                lay-affix="eye"
              />
            </div>
          </div>
          <div class="layui-form-item" style="margin-bottom: 12px">
            <input
              type="checkbox"
              name="remember"
              lay-skin="primary"
              lay-filter="remember"
              title="Lưu tài khoản"
              id="chkRemember"
            />
          </div>
          <div class="layui-form-item">
            <button
              type="button"
              class="layui-btn layui-btn-fluid"
              lay-submit
              lay-filter="doLogin"
              data-i18n="loginBtn"
            >
              Đăng nhập
            </button>
          </div>
        </form>
        <div class="login-footer">Agent Hub &copy; 2024</div>
      </div>
    </div>

    <script src="/lib/layui/layui.js"></script>
    <script src="/js/hub-api.js"></script>
    <script src="/js/hub-lang.js"></script>
    <script>
      // Nếu đã đăng nhập → redirect admin
      if (HubAPI.isLoggedIn()) {
        window.location.href = '/pages/admin.html';
      }

      HubLang.init();
      document.title = HubLang.t('loginPageTitle');

      layui.use(['form', 'layer', 'i18n'], function () {
        var form = layui.form;
        var layer = layui.layer;

        HubLang.applyDOM();

        // Restore saved account
        var saved = localStorage.getItem('hub_saved_user');
        if (saved) {
          document.querySelector('input[name="username"]').value = saved;
          document.getElementById('chkRemember').checked = true;
          form.render('checkbox');
        }

        form.on('submit(doLogin)', function (data) {
          var username = data.field.username;
          var password = data.field.password;

          var loadIdx = layer.load();

          HubAPI.login(username, password)
            .then(function (res) {
              layer.close(loadIdx);
              if (res.code === 0) {
                // Save or clear account
                if (document.getElementById('chkRemember').checked) {
                  localStorage.setItem('hub_saved_user', username);
                } else {
                  localStorage.removeItem('hub_saved_user');
                }
                layer.msg(
                  HubLang.t('loginSuccess'),
                  { icon: 1, time: 1000 },
                  function () {
                    window.location.href = '/pages/admin.html';
                  }
                );
              } else {
                layer.msg(res.msg || HubLang.t('loginFailed'), { icon: 2 });
              }
            })
            .catch(function (err) {
              layer.close(loadIdx);
              layer.msg(HubLang.t('connectionError'), { icon: 2 });
            });

          return false;
        });

        // Enter key submit
        document.addEventListener('keydown', function (e) {
          if (e.key === 'Enter') {
            document.querySelector('[lay-filter="doLogin"]').click();
          }
        });
      });
    </script>
  </body>
</html>
