<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Agent Hub — Đăng nhập</title>
    <link rel="stylesheet" href="/lib/layui/css/layui.css" />
    <link rel="stylesheet" href="/css/hub-icons.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Inter:wght@300;400;500;600&display=swap"
      rel="stylesheet"
    />

    <style>
      @property --b {
        syntax: '<angle>';
        initial-value: 0deg;
        inherits: false;
      }

      *,
      *::before,
      *::after {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      html,
      body {
        height: 100%;
        font-family: 'Inter', sans-serif;
        background: #0a0a0f;
        overflow: hidden;
      }

      /* ── CSS Variables ── */
      :root {
        --input-h: 42px;
        --icon-w: 42px;
        --input-pl: 50px;
        --radius: 8px;
        --gap: 14px;
        --card-px: 24px;
        --card-pt: 28px;
        --card-pb: 20px;
      }

      /* ── LAYOUT: Split screen ── */
      .login-wrap {
        display: flex;
        min-height: 100vh;
      }

      /* ── LEFT: Image panel ── */
      .login-image-panel {
        flex: 1;
        position: relative;
        overflow: hidden;
      }

      .login-image-panel .bg-img {
        position: absolute;
        inset: 0;
        background-size: cover;
        background-position: center top;
        transform: scale(1.05);
        animation: subtleZoom 20s ease-in-out infinite alternate;
      }

      @keyframes subtleZoom {
        from {
          transform: scale(1.05);
        }
        to {
          transform: scale(1.12);
        }
      }

      .login-image-panel::after {
        content: '';
        position: absolute;
        inset: 0;
        background:
          linear-gradient(
            to right,
            transparent 40%,
            rgba(5, 5, 15, 0.7) 70%,
            rgba(5, 5, 15, 1) 100%
          ),
          linear-gradient(
            to bottom,
            rgba(5, 5, 15, 0.3) 0%,
            transparent 20%,
            transparent 70%,
            rgba(5, 5, 15, 0.6) 100%
          );
        z-index: 1;
      }

      .image-overlay-text {
        position: absolute;
        bottom: 60px;
        left: 50px;
        z-index: 2;
        color: #fff;
      }
      .image-overlay-text h2 {
        font-family: 'Cinzel', serif;
        font-size: 36px;
        font-weight: 700;
        line-height: 1.2;
        text-shadow: 0 2px 20px rgba(0, 0, 0, 0.8);
        letter-spacing: 2px;
      }
      .image-overlay-text h2 span {
        color: #fb923c;
        text-shadow:
          0 0 30px rgba(251, 146, 60, 0.6),
          0 2px 20px rgba(0, 0, 0, 0.8);
      }
      .image-overlay-text p {
        font-size: 13px;
        color: rgba(255, 255, 255, 0.6);
        margin-top: 8px;
        letter-spacing: 3px;
        text-transform: uppercase;
      }

      /* Particles */
      .particles {
        position: absolute;
        inset: 0;
        z-index: 2;
        pointer-events: none;
        overflow: hidden;
      }
      .particle {
        position: absolute;
        bottom: -10px;
        width: 3px;
        height: 3px;
        border-radius: 50%;
        background: radial-gradient(circle, #fb923c, #fb7185);
        box-shadow: 0 0 6px #fb923c;
        animation: floatUp var(--dur, 6s) var(--delay, 0s) ease-in infinite;
        opacity: 0;
      }
      @keyframes floatUp {
        0% {
          transform: translateY(0) translateX(0) scale(1);
          opacity: 0;
        }
        10% {
          opacity: 1;
        }
        80% {
          opacity: 0.6;
        }
        100% {
          transform: translateY(-600px) translateX(var(--drift, 30px))
            scale(0.3);
          opacity: 0;
        }
      }

      /* ── RIGHT: Form panel ── */
      .login-form-panel {
        width: 440px;
        flex-shrink: 0;
        background: linear-gradient(135deg, #05050f 0%, #0a0a18 100%);
        display: flex;
        align-items: center;
        justify-content: flex-start;
        padding-left: 30px;
        position: relative;
        z-index: 2;
      }

      .login-form-panel::before {
        content: '';
        position: absolute;
        width: 500px;
        height: 500px;
        background: radial-gradient(
          circle,
          rgba(251, 113, 133, 0.06) 0%,
          transparent 70%
        );
        top: 50%;
        left: 40%;
        transform: translate(-50%, -50%);
        pointer-events: none;
      }

      /* ── The CARD ── */
      .login-box {
        position: relative;
        width: 360px;
        background: #13131d;
        border-radius: 16px;
        padding: var(--card-pt) var(--card-px) var(--card-pb);
        isolation: isolate;
      }

      .login-box::before {
        content: '';
        position: absolute;
        inset: -2px;
        border-radius: 18px;
        background: conic-gradient(
          from var(--b),
          #d4b44a 0%,
          transparent 12%,
          #fb7185 33%,
          transparent 42%,
          #a78bfa 63%,
          transparent 74%,
          #22d3ee 94%,
          transparent 100%
        );
        z-index: -2;
        animation: spin 4s linear infinite;
      }
      .login-box::after {
        content: '';
        position: absolute;
        inset: 0;
        border-radius: 16px;
        background: #13131d;
        z-index: -1;
      }
      @keyframes spin {
        to {
          --b: 360deg;
        }
      }

      .card-glow {
        position: absolute;
        width: 300px;
        height: 300px;
        background: radial-gradient(
          circle,
          rgba(212, 180, 74, 0.08),
          transparent 60%
        );
        top: var(--my, 50%);
        left: var(--mx, 50%);
        transform: translate(-50%, -50%);
        pointer-events: none;
        z-index: 0;
        border-radius: 50%;
        transition:
          top 0.1s,
          left 0.1s;
      }

      /* ── Logo ── */
      .login-logo {
        text-align: center;
        margin-bottom: 22px;
        position: relative;
        z-index: 1;
      }
      .logo-icon-wrap {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 48px;
        height: 48px;
        background: linear-gradient(135deg, #fb923c, #fb7185);
        border-radius: 12px;
        margin-bottom: 8px;
        box-shadow: 0 6px 20px rgba(251, 113, 133, 0.35);
      }
      .logo-icon-wrap .hi {
        font-size: 24px;
        color: #fff;
      }
      .login-logo h1 {
        font-family: 'Cinzel', serif;
        font-size: 20px;
        font-weight: 700;
        color: #fff;
        letter-spacing: 3px;
      }
      .login-logo h1 span {
        background: linear-gradient(90deg, #fb923c, #fb7185);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }
      .login-logo p {
        font-size: 11px;
        color: rgba(255, 255, 255, 0.35);
        letter-spacing: 4px;
        text-transform: uppercase;
        margin-top: 4px;
      }

      /* ── INPUT FIELDS ── */
      .login-box .layui-form-item {
        margin-bottom: var(--gap);
        position: relative;
        z-index: 1;
      }

      .input-field-group {
        position: relative;
      }

      .input-field-group .field-icon {
        position: absolute;
        left: 0;
        top: 0;
        width: var(--icon-w);
        height: var(--input-h);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 2;
        pointer-events: none;
      }
      .input-field-group .field-icon i {
        font-size: 16px;
        color: rgba(255, 255, 255, 0.25);
        transition: color 0.3s;
      }
      .input-field-group .field-icon::after {
        content: '';
        position: absolute;
        right: 0;
        top: 50%;
        transform: translateY(-50%);
        width: 1px;
        height: 20px;
        background: rgba(255, 255, 255, 0.08);
        transition: background 0.3s;
      }

      .input-field-group input.styled-input {
        width: 100%;
        height: var(--input-h);
        line-height: var(--input-h);
        padding: 0 14px 0 var(--input-pl);
        border-radius: var(--radius);
        background: rgba(255, 255, 255, 0.04);
        border: 1px solid rgba(255, 255, 255, 0.08);
        color: #fff;
        font-family: 'Inter', sans-serif;
        font-size: 14px;
        font-weight: 400;
        letter-spacing: 0.3px;
        outline: none;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        -webkit-appearance: none;
      }
      .input-field-group input.styled-input::placeholder {
        color: rgba(255, 255, 255, 0.25);
        font-weight: 300;
      }

      /* Focus state */
      .input-field-group input.styled-input:focus {
        background: rgba(255, 255, 255, 0.06);
        border-color: rgba(251, 146, 60, 0.5);
        box-shadow:
          0 0 0 3px rgba(251, 146, 60, 0.08),
          0 0 20px rgba(251, 113, 133, 0.06),
          inset 0 1px 0 rgba(255, 255, 255, 0.03);
      }
      .input-field-group:focus-within .field-icon i {
        color: #fb923c;
      }
      .input-field-group:focus-within .field-icon::after {
        background: rgba(251, 146, 60, 0.3);
      }

      /* Filled state */
      .input-field-group input.styled-input:not(:placeholder-shown) {
        background: rgba(255, 255, 255, 0.05);
        border-color: rgba(255, 255, 255, 0.12);
      }

      /* Password toggle */
      .input-field-group .pwd-toggle {
        position: absolute;
        right: 12px;
        top: 50%;
        transform: translateY(-50%);
        background: none;
        border: none;
        color: rgba(255, 255, 255, 0.25);
        cursor: pointer;
        padding: 4px;
        z-index: 2;
        transition: color 0.2s;
        font-size: 16px;
      }
      .input-field-group .pwd-toggle:hover {
        color: rgba(255, 255, 255, 0.6);
      }

      /* ── CAPTCHA ROW ── */
      .captcha-row {
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .captcha-row .input-field-group {
        flex: 1;
      }
      .captcha-row canvas {
        cursor: pointer;
        border-radius: var(--radius);
        border: 1px solid rgba(255, 255, 255, 0.08);
        flex-shrink: 0;
        transition:
          border-color 0.3s,
          transform 0.2s;
        background: #1a1a2e;
      }
      .captcha-row canvas:hover {
        border-color: rgba(251, 146, 60, 0.4);
        transform: scale(1.02);
      }
      .captcha-row canvas:active {
        transform: scale(0.98);
      }

      .captcha-tip {
        font-size: 11px;
        color: rgba(255, 255, 255, 0.2);
        margin-top: -6px;
        margin-bottom: 6px;
        text-align: right;
        position: relative;
        z-index: 1;
      }

      /* ── Remember checkbox ── */
      .remember-row {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: var(--gap);
        position: relative;
        z-index: 1;
      }
      .remember-row input[type='checkbox'] {
        width: 16px;
        height: 16px;
        accent-color: #fb923c;
        cursor: pointer;
      }
      .remember-row label {
        color: rgba(255, 255, 255, 0.45);
        font-size: 13px;
        cursor: pointer;
        user-select: none;
      }

      /* ── Submit button ── */
      .btn-login {
        width: 100%;
        height: var(--input-h);
        border: none;
        border-radius: var(--radius);
        background: linear-gradient(135deg, #fb923c 0%, #fb7185 100%);
        color: #fff;
        font-family: 'Inter', sans-serif;
        font-size: 14px;
        font-weight: 600;
        letter-spacing: 1px;
        cursor: pointer;
        position: relative;
        overflow: hidden;
        box-shadow: 0 4px 20px rgba(251, 113, 133, 0.4);
        transition:
          transform 0.2s,
          box-shadow 0.2s;
        z-index: 1;
      }
      .btn-login::before {
        content: '';
        position: absolute;
        inset: 0;
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.15),
          transparent
        );
        opacity: 0;
        transition: opacity 0.3s;
      }
      .btn-login:hover {
        transform: translateY(-1px);
        box-shadow: 0 8px 28px rgba(251, 113, 133, 0.5);
      }
      .btn-login:hover::before {
        opacity: 1;
      }
      .btn-login:active {
        transform: translateY(0);
      }

      /* ── LANGUAGE SELECTOR ── */
      .lang-bar {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 4px;
        margin-top: 16px;
        position: relative;
        z-index: 1;
        background: rgba(255, 255, 255, 0.03);
        border-radius: var(--radius);
        padding: 3px;
        border: 1px solid rgba(255, 255, 255, 0.05);
      }

      .lang-bar a {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 5px;
        flex: 1;
        padding: 6px 8px;
        color: rgba(255, 255, 255, 0.35);
        font-size: 11px;
        font-weight: 500;
        text-decoration: none;
        border-radius: 6px;
        transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        letter-spacing: 0.5px;
      }
      .lang-bar a:hover {
        color: rgba(255, 255, 255, 0.7);
        background: rgba(255, 255, 255, 0.04);
      }
      .lang-bar a.active {
        color: #fff;
        background: linear-gradient(
          135deg,
          rgba(251, 146, 60, 0.2),
          rgba(251, 113, 133, 0.15)
        );
        border: 1px solid rgba(251, 146, 60, 0.25);
        box-shadow: 0 0 12px rgba(251, 146, 60, 0.1);
      }
      .lang-bar a img {
        width: 18px;
        height: 13px;
        border-radius: 2px;
        opacity: 0.6;
        transition: opacity 0.2s;
      }
      .lang-bar a:hover img,
      .lang-bar a.active img {
        opacity: 1;
      }

      .login-footer {
        text-align: center;
        color: rgba(255, 255, 255, 0.15);
        font-size: 11px;
        margin-top: 12px;
        letter-spacing: 1px;
        position: relative;
        z-index: 1;
      }

      /* ── RESPONSIVE — Tablet ── */
      @media (max-width: 1024px) {
        .login-form-panel {
          width: 420px;
          padding-left: 20px;
        }
        .login-box {
          width: 350px;
        }
        .image-overlay-text h2 {
          font-size: 30px;
        }
      }

      /* ── RESPONSIVE — Mobile ── */
      @media (max-width: 768px) {
        :root {
          --input-h: 44px;
          --icon-w: 44px;
          --input-pl: 52px;
          --card-px: 24px;
          --card-pt: 28px;
          --card-pb: 20px;
        }
        .login-image-panel {
          display: none;
        }
        .login-wrap {
          justify-content: center;
          align-items: center;
          background: radial-gradient(
            ellipse at 50% 30%,
            #141420 0%,
            #0a0a0f 70%
          );
        }
        .login-form-panel {
          width: 100%;
          max-width: 100vw;
          padding: 20px;
          justify-content: center;
          background: transparent;
        }
        .login-form-panel::before {
          display: none;
        }
        .login-box {
          width: 100%;
          max-width: 360px;
        }
        .input-field-group input.styled-input {
          font-size: 16px;
        }
        .lang-bar a img {
          width: 16px;
          height: 12px;
        }
      }

      /* ── RESPONSIVE — Small phones ── */
      @media (max-width: 380px) {
        :root {
          --card-px: 18px;
          --card-pt: 24px;
          --card-pb: 18px;
          --gap: 12px;
        }
        .login-form-panel {
          padding: 14px;
        }
        .login-box {
          border-radius: 14px;
        }
        .login-box::before {
          border-radius: 16px;
        }
        .login-logo {
          margin-bottom: 18px;
        }
        .logo-icon-wrap {
          width: 42px;
          height: 42px;
        }
        .logo-icon-wrap .hi {
          font-size: 20px;
        }
        .login-logo h1 {
          font-size: 18px;
        }
        .captcha-row canvas {
          width: 96px;
        }
        .lang-bar a {
          font-size: 10px;
          gap: 4px;
        }
      }

      @supports (padding: max(0px)) {
        @media (max-width: 768px) {
          .login-form-panel {
            padding-left: max(20px, env(safe-area-inset-left));
            padding-right: max(20px, env(safe-area-inset-right));
            padding-bottom: max(20px, env(safe-area-inset-bottom));
          }
        }
      }

      @media (max-height: 600px) and (max-width: 768px) {
        :root {
          --gap: 10px;
          --card-pt: 20px;
          --card-pb: 16px;
        }
        .login-form-panel {
          align-items: flex-start;
          overflow-y: auto;
          padding-top: 16px;
          padding-bottom: 16px;
        }
        .login-logo {
          margin-bottom: 14px;
        }
        .logo-icon-wrap {
          width: 36px;
          height: 36px;
          margin-bottom: 6px;
        }
        .logo-icon-wrap .hi {
          font-size: 18px;
        }
        .login-logo h1 {
          font-size: 17px;
        }
        .login-logo p {
          margin-top: 2px;
          font-size: 10px;
        }
        .captcha-tip {
          margin-bottom: 4px;
        }
        .lang-bar {
          margin-top: 10px;
        }
        .login-footer {
          margin-top: 8px;
        }
      }
    </style>
  </head>
  <body>
    <div class="login-wrap">
      <!-- LEFT PANEL: image -->
      <div class="login-image-panel" id="imagePanel">
        <div class="bg-img" id="bgImg"></div>
        <div class="particles" id="particles"></div>
        <div class="image-overlay-text">
          <h2>LOGIN <span>HUB</span></h2>
          <p>Management System</p>
        </div>
      </div>

      <!-- RIGHT PANEL: form -->
      <div class="login-form-panel">
        <div class="login-box" id="loginCard">
          <div class="card-glow" id="cardGlow"></div>

          <div class="login-logo">
            <div class="logo-icon-wrap">
              <i class="hi hi-fire-flame-curved"></i>
            </div>
            <h1>LOGIN <span>HUB</span></h1>
            <p>Management System</p>
          </div>

          <form class="layui-form" lay-filter="loginForm" autocomplete="off">
            <!-- Username -->
            <div class="layui-form-item">
              <div class="input-field-group">
                <input
                  type="text"
                  name="username"
                  id="inputUser"
                  lay-verify="required"
                  data-i18n="username"
                  data-i18n-attr="placeholder"
                  placeholder="Tên đăng nhập"
                  autocomplete="off"
                  class="styled-input"
                  autofocus
                />
                <div class="field-icon">
                  <i class="hi hi-circle-user"></i>
                </div>
              </div>
            </div>

            <!-- Password -->
            <div class="layui-form-item">
              <div class="input-field-group">
                <input
                  type="password"
                  name="password"
                  id="inputPass"
                  lay-verify="required"
                  data-i18n="password"
                  data-i18n-attr="placeholder"
                  placeholder="Mật khẩu"
                  autocomplete="off"
                  class="styled-input"
                />
                <div class="field-icon">
                  <i class="hi hi-lock"></i>
                </div>
                <button
                  type="button"
                  class="pwd-toggle"
                  id="pwdToggle"
                  tabindex="-1"
                >
                  <i class="hi hi-eye"></i>
                </button>
              </div>
            </div>

            <!-- Captcha -->
            <div class="layui-form-item">
              <div class="captcha-row">
                <div class="input-field-group">
                  <input
                    type="text"
                    name="captcha"
                    id="inputCaptcha"
                    lay-verify="required"
                    data-i18n="captchaPlaceholder"
                    data-i18n-attr="placeholder"
                    placeholder="Mã xác nhận"
                    autocomplete="off"
                    class="styled-input"
                    maxlength="4"
                  />
                  <div class="field-icon">
                    <i class="hi hi-shield-halved"></i>
                  </div>
                </div>
                <canvas
                  id="captchaCanvas"
                  width="110"
                  height="42"
                  title="Click để đổi mã"
                ></canvas>
              </div>
            </div>
            <div class="captcha-tip" data-i18n="captchaClickRefresh">
              Click hình để đổi mã
            </div>

            <!-- Remember -->
            <div class="remember-row">
              <input type="checkbox" id="chkRemember" />
              <label for="chkRemember" data-i18n="saveAccount"
                >Lưu tài khoản</label
              >
            </div>

            <div class="layui-form-item" style="margin-bottom: 0">
              <button
                type="button"
                class="btn-login"
                lay-submit
                lay-filter="doLogin"
                data-i18n="loginBtn"
              >
                Đăng nhập
              </button>
            </div>
          </form>

          <!-- Language selector -->
          <div class="lang-bar" id="langBar">
            <a href="javascript:;" data-lang="vi"
              ><img src="/images/vn.svg" alt="VI" />VI</a
            >
            <a href="javascript:;" data-lang="en"
              ><img src="/images/uk.svg" alt="EN" />EN</a
            >
            <a href="javascript:;" data-lang="zh-CN"
              ><img src="/images/china.svg" alt="CN" />CN</a
            >
          </div>
          <div class="login-footer">Agent Hub &copy; 2024</div>
        </div>
      </div>
    </div>

    <script src="/lib/layui/layui.js"></script>
    <script src="/js/hub-api.js"></script>
    <script src="/js/hub-lang.js"></script>
    <script>
      // ── Background image ──
      document.getElementById('bgImg').style.backgroundImage =
        "url('/images/bg-login.jpg')";

      // ── Particles ──
      (function spawnParticles() {
        var container = document.getElementById('particles');
        for (var i = 0; i < 25; i++) {
          var p = document.createElement('div');
          p.className = 'particle';
          p.style.left = 20 + Math.random() * 60 + '%';
          p.style.setProperty('--dur', 4 + Math.random() * 6 + 's');
          p.style.setProperty('--delay', Math.random() * 8 + 's');
          p.style.setProperty('--drift', (Math.random() - 0.5) * 80 + 'px');
          p.style.width = p.style.height = 1.5 + Math.random() * 2.5 + 'px';
          container.appendChild(p);
        }
      })();

      // ── Mouse glow on card ──
      var card = document.getElementById('loginCard');
      var glow = document.getElementById('cardGlow');
      card.addEventListener('mousemove', function (e) {
        var rect = card.getBoundingClientRect();
        glow.style.setProperty('--mx', e.clientX - rect.left + 'px');
        glow.style.setProperty('--my', e.clientY - rect.top + 'px');
      });

      // ── Password toggle ──
      var pwdToggle = document.getElementById('pwdToggle');
      var pwdInput = document.getElementById('inputPass');
      pwdToggle.addEventListener('click', function () {
        var isPassword = pwdInput.type === 'password';
        pwdInput.type = isPassword ? 'text' : 'password';
        pwdToggle.querySelector('i').className =
          'hi ' + (isPassword ? 'hi-eye-slash' : 'hi-eye');
      });

      // ── Captcha Generator ──
      var captchaCode = '';
      var captchaCanvas = document.getElementById('captchaCanvas');
      var captchaCtx = captchaCanvas.getContext('2d');

      function generateCaptcha() {
        var chars = 'ABCDEFGHJKMNPQRSTUVWXYZabcdefghjkmnpqrstuvwxyz23456789';
        captchaCode = '';
        for (var i = 0; i < 4; i++)
          captchaCode += chars[Math.floor(Math.random() * chars.length)];

        var W = captchaCanvas.width,
          H = captchaCanvas.height;
        captchaCtx.clearRect(0, 0, W, H);

        var bgGrad = captchaCtx.createLinearGradient(0, 0, W, H);
        bgGrad.addColorStop(0, '#13131d');
        bgGrad.addColorStop(1, '#1a1a2e');
        captchaCtx.fillStyle = bgGrad;
        captchaCtx.fillRect(0, 0, W, H);

        for (var d = 0; d < 15; d++) {
          captchaCtx.fillStyle = 'rgba(255,255,255,0.06)';
          captchaCtx.beginPath();
          captchaCtx.arc(rand(0, W), rand(0, H), rand(1, 2), 0, Math.PI * 2);
          captchaCtx.fill();
        }

        for (var l = 0; l < 2; l++) {
          captchaCtx.strokeStyle = 'rgba(251,146,60,0.15)';
          captchaCtx.lineWidth = 1;
          captchaCtx.beginPath();
          captchaCtx.moveTo(rand(0, 10), rand(10, H - 10));
          captchaCtx.bezierCurveTo(
            rand(20, 50),
            rand(0, H),
            rand(70, 100),
            rand(0, H),
            rand(W - 10, W),
            rand(10, H - 10)
          );
          captchaCtx.stroke();
        }

        var palette = ['#fb923c', '#fb7185', '#a78bfa', '#22d3ee', '#fcd34d'];
        var spacing = (W - 16) / 4;
        for (var c = 0; c < 4; c++) {
          captchaCtx.save();
          captchaCtx.font = 'bold ' + rand(18, 24) + 'px Inter, sans-serif';
          captchaCtx.fillStyle = palette[rand(0, palette.length - 1)];
          captchaCtx.textBaseline = 'middle';
          captchaCtx.textAlign = 'center';
          captchaCtx.translate(12 + c * spacing, H / 2 + rand(-3, 3));
          captchaCtx.rotate((rand(-12, 12) * Math.PI) / 180);
          captchaCtx.fillText(captchaCode[c], 0, 0);
          captchaCtx.restore();
        }
        document.getElementById('inputCaptcha').value = '';
      }
      function rand(min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min;
      }
      captchaCanvas.addEventListener('click', generateCaptcha);
      generateCaptcha();

      // ── i18n ──
      if (typeof HubLang !== 'undefined') {
        HubLang.init();
        document.title = HubLang.t('loginPageTitle');
        HubLang.applyDOM();
        var cur = HubLang.getLang();
        document.querySelectorAll('#langBar a').forEach(function (a) {
          a.classList.toggle('active', a.getAttribute('data-lang') === cur);
        });
      }

      document
        .getElementById('langBar')
        .addEventListener('click', function (e) {
          var a = e.target.closest('a[data-lang]');
          if (!a || typeof HubLang === 'undefined') return;
          e.preventDefault();
          HubLang.setLang(a.getAttribute('data-lang'));
          HubLang.applyDOM();
          document.querySelectorAll('#langBar a').forEach(function (b) {
            b.classList.toggle(
              'active',
              b.getAttribute('data-lang') === HubLang.getLang()
            );
          });
        });

      // ── Login ──
      if (typeof layui !== 'undefined') {
        if (typeof HubAPI !== 'undefined' && HubAPI.isLoggedIn()) {
          window.location.href = '/pages/admin.html';
        }

        // Restore saved account
        var saved = localStorage.getItem('hub_saved_user');
        if (saved) {
          document.getElementById('inputUser').value = saved;
          document.getElementById('chkRemember').checked = true;
        }

        layui.use(['form', 'layer'], function () {
          var form = layui.form,
            layer = layui.layer;
          form.on('submit(doLogin)', function (data) {
            if (
              data.field.captcha.toLowerCase() !== captchaCode.toLowerCase()
            ) {
              layer.msg(HubLang.t('captchaWrong'), { icon: 2 });
              generateCaptcha();
              return false;
            }
            var idx = layer.load();
            HubAPI.login(data.field.username, data.field.password)
              .then(function (res) {
                layer.close(idx);
                if (res.code === 0) {
                  // Save or clear account
                  if (document.getElementById('chkRemember').checked) {
                    localStorage.setItem('hub_saved_user', data.field.username);
                  } else {
                    localStorage.removeItem('hub_saved_user');
                  }
                  layer.msg(
                    HubLang.t('loginSuccess'),
                    { icon: 1, time: 1000 },
                    function () {
                      window.location.href = '/pages/admin.html';
                    }
                  );
                } else {
                  layer.msg(res.msg || HubLang.t('loginFailed'), { icon: 2 });
                  generateCaptcha();
                }
              })
              .catch(function () {
                layer.close(idx);
                layer.msg(HubLang.t('connectionError'), { icon: 2 });
                generateCaptcha();
              });
            return false;
          });
          document.addEventListener('keydown', function (e) {
            if (e.key === 'Enter')
              document.querySelector('[lay-filter="doLogin"]').click();
          });
        });
      }
    </script>
  </body>
</html>
